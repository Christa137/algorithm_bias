import{_ as F}from"./PageLayout-wVpgxbnR.js";import{s as c,c as N,A as j,K as f,L as a,D as A,J as m,h as t,M as o,H as K,Q as x,F as H,O as I,R,S as h,N as y,P as $,T as q,U as E}from"./index-BrTml2Fb.js";import{V as J,a as Q}from"./VFooter-DZSFhVtD.js";import{_ as X,j as _,r as u,t as G,v as L,w as W}from"./VContainer-27DPJaY0.js";import{b as Y,V as Z,a as ee,c as te}from"./VAppBar-cBfAJn_8.js";import{V as ae}from"./VRow-pG9w0uUi.js";import{V as P}from"./VCol-CwX0XoVG.js";import{V as B,a as se,c as D,d as le}from"./VCard-5mUneJXI.js";import{V as oe,a as re,b as ie}from"./VTextarea-DIXiXlS-.js";import{V as b}from"./VTextField-DDRmobaA.js";import{V as ne,a as S}from"./VList-DaZ_f4gr.js";import"./lazy-CYPMe5ey.js";const ue={class:"message-content"},de={class:"text-body-1"},me={class:"text-caption text-medium-emphasis mt-1 text-right"},pe={__name:"strategy_approach",setup(ce){const p=c([{content:"您好！请发送消息，我会尽力为您提供帮助。",isUser:!1,timestamp:new Date().toLocaleTimeString()}]),r=c(""),d=c(!1),v=c(null),l=c({shopType:"",originalPrice:"",competitorPrice:"",negotiationProcess:"",alternativeOption:""}),M=N(()=>Object.values(l.value).some(i=>i.trim()!=="")),z=()=>["【博弈策略分析请求】",l.value.shopType&&`商家类型：${l.value.shopType}`,l.value.originalPrice&&`初始报价：${l.value.originalPrice}元`,l.value.competitorPrice&&`市场参考价：${l.value.competitorPrice}元`,l.value.negotiationProcess&&`沟通记录：${l.value.negotiationProcess}`,l.value.alternativeOption&&`替代渠道：${l.value.alternativeOption}`].filter(Boolean).join(`
`),O=async()=>{const i=z();i&&(r.value=i,await T(),l.value={productName:"",productPrice:"",productLink:"",problemDescription:""})},w=async()=>{await A(),v.value&&v.value.$el.scrollTo({top:v.value.$el.scrollHeight,behavior:"smooth"})},T=async()=>{var V,s,g,U;if(!r.value.trim())return;const i={content:r.value,isUser:!0,timestamp:new Date().toLocaleTimeString()};p.value.push(i);const e=r.value;r.value="",await w(),d.value=!0;try{const k=()=>p.value.filter(n=>!n.hidden).map(n=>({role:n.isUser?"user":"assistant",content:n.content})).slice(-10),C=await Q.post("https://api.deepseek.com/v1/chat/completions",{messages:[{role:"system",content:`你是一位专注消费者议价支持的消费顾问，请优先判断用户当前是否提出了需要法律/策略分析的问题
            你的回答不要使用以下模板，模板只是给你提供信息的，用自然的语言说出来：
            - 如用户仅提供背景信息，请先简要总结背景并澄清用户需求。
            - 如用户明确提出定价或合规问题，请再根据以下结构化流程处理请求：
            1. 【需求解析】判断用户是直接求助还是提供背景信息，明确谈判目标  
            2. 【历史回溯】关联最近5轮对话内容：  
            ${k().map(n=>`[${n.role}]: ${n.content}`).join(`
`)}  
            3. 【实用分析】从以下5方面支持用户议价：  
              - 报价合理性分析（结合市场均价、同类商品对比）  
              - 三种阶梯式还价策略（保守型、中间型、激进型）  
              - 商家定价漏洞识别（如临期、清仓、服务缩水等）  
              - 替代渠道推荐（网购平台、二手市场、平行进口等）  
              - 消费者权益法律依据（如《消法》第八条、第十九条等）  
            4. 【结论输出】格式如下：  
              价格评估：当前报价 vs 市场价分析  
              谈判建议：分策略步骤说明  
              法律依据：适用法条说明及维权提示  
              替代方案：可选购买路径与对比理由`},{role:"user",content:e}],model:"deepseek-chat",temperature:.02,max_tokens:2e3},{headers:{Authorization:"Bearer sk-03b7d3c94bcc432ea14c45b2d501c58f","Content-Type":"application/json"}});(U=(g=(s=(V=C.data)==null?void 0:V.choices)==null?void 0:s[0])==null?void 0:g.message)!=null&&U.content&&p.value.push({content:C.data.choices[0].message.content,isUser:!1,timestamp:new Date().toLocaleTimeString()})}catch(k){p.value.push({content:`请求失败：${k.message}`,isUser:!1,timestamp:new Date().toLocaleTimeString()})}finally{d.value=!1,await w()}};return j(w),(i,e)=>{const V=F;return m(),f(V,null,{default:a(()=>[t(Y,{flat:"",color:"primary",dark:"",class:"app-bar",height:"80",elevation:4},{default:a(()=>[t(Z,{color:"transparent",class:"pt-2"},{default:a(()=>[t(_,{icon:"",onClick:e[0]||(e[0]=s=>i.$router.go(-1)),class:"mr-2"},{default:a(()=>[t(u,{size:"32",color:"white"},{default:a(()=>e[7]||(e[7]=[o("mdi-arrow-left-circle")])),_:1})]),_:1}),t(ee,{class:"text-h5 font-weight-bold white--text"},{default:a(()=>[e[9]||(e[9]=o(" 博弈策略智能客服 ")),t(u,{right:"",dark:"",class:"ml-2"},{default:a(()=>e[8]||(e[8]=[o("mdi-currency-usd")])),_:1})]),_:1})]),_:1})]),_:1}),t(G,{class:"py-8"},{default:a(()=>[t(ae,null,{default:a(()=>[t(P,{cols:"12",md:"4",class:"pr-md-4"},{default:a(()=>[t(B,{class:"template-card",elevation:"6"},{default:a(()=>[t(se,{class:"primary white--text"},{default:a(()=>[t(u,{left:""},{default:a(()=>e[10]||(e[10]=[o("mdi-file-document-edit")])),_:1}),e[11]||(e[11]=o(" 博弈策略分析模板 "))]),_:1}),t(D,{class:"pt-4"},{default:a(()=>[t(oe,{ref:"form",class:"template-form"},{default:a(()=>[t(re,{modelValue:l.value.shopType,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.shopType=s),label:"商家类型",items:["电商平台","实体店铺","服务机构","个人商家"],variant:"outlined","prepend-inner-icon":"mdi-store",required:""},null,8,["modelValue"]),t(b,{modelValue:l.value.originalPrice,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.originalPrice=s),label:"商品初始报价",type:"number",variant:"outlined","prepend-inner-icon":"mdi-tag",suffix:"元"},null,8,["modelValue"]),t(b,{modelValue:l.value.competitorPrice,"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.competitorPrice=s),label:"市场参考价",type:"number",variant:"outlined","prepend-inner-icon":"mdi-scale-balance",suffix:"元"},null,8,["modelValue"]),t(ie,{modelValue:l.value.negotiationProcess,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.negotiationProcess=s),label:"价格谈判过程",variant:"outlined","prepend-inner-icon":"mdi-comment-text",rows:"3",hint:"记录与商家的沟通内容和拒绝理由","persistent-hint":""},null,8,["modelValue"]),t(b,{modelValue:l.value.alternativeOption,"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.alternativeOption=s),label:"替代方案准备",variant:"outlined","prepend-inner-icon":"mdi-swap-horizontal",hint:"同类商品的其他购买渠道","persistent-hint":""},null,8,["modelValue"]),t(_,{block:"",color:"primary",class:"mt-4",onClick:O,disabled:!M.value},{default:a(()=>[t(u,{left:""},{default:a(()=>e[12]||(e[12]=[o("mdi-handshake")])),_:1}),e[13]||(e[13]=o(" 提交分析 "))]),_:1},8,["disabled"])]),_:1},512)]),_:1})]),_:1})]),_:1}),t(P,{cols:"12",md:"8",class:"pl-md-4"},{default:a(()=>[t(B,{class:"chat-container mx-auto",elevation:"6"},{default:a(()=>[t(D,{class:"message-window pa-4"},{default:a(()=>[t(ne,{class:"message-list",ref_key:"messageList",ref:v},{default:a(()=>[(m(!0),K(H,null,I(p.value,(s,g)=>(m(),f(te,{key:g},{default:a(()=>[t(S,{class:h(["message-item",{"user-message":s.isUser}]),style:R({flexDirection:s.isUser?"row-reverse":"row"})},{default:a(()=>[s.isUser?x("",!0):(m(),f(L,{key:0,color:"primary",class:"mr-4",size:"40"},{default:a(()=>[t(u,{dark:""},{default:a(()=>e[14]||(e[14]=[o("mdi-robot-happy")])),_:1})]),_:1})),s.isUser?(m(),f(L,{key:1,color:"secondary",class:"ml-4",size:"40"},{default:a(()=>[t(u,{dark:""},{default:a(()=>e[15]||(e[15]=[o("mdi-account")])),_:1})]),_:1})):x("",!0),y("div",ue,[y("div",{class:h(["message-bubble",{"user-bubble":s.isUser}])},[y("div",de,$(s.content),1),y("div",me,$(s.timestamp),1)],2)])]),_:2},1032,["class","style"])]),_:2},1024))),128)),d.value?(m(),f(S,{key:0},{default:a(()=>[t(W,{indeterminate:"",color:"primary"})]),_:1})):x("",!0)]),_:1},512)]),_:1}),t(le,{class:"input-area pa-4"},{default:a(()=>[t(b,{modelValue:r.value,"onUpdate:modelValue":e[6]||(e[6]=s=>r.value=s),variant:"outlined",label:"输入您的消息","hide-details":"",onKeydown:q(E(T,["prevent"]),["enter"]),disabled:d.value},null,8,["modelValue","onKeydown","disabled"]),t(_,{color:"primary",class:"ml-4",onClick:T,disabled:!r.value||d.value,loading:d.value},{default:a(()=>[t(u,null,{default:a(()=>e[16]||(e[16]=[o("mdi-send")])),_:1}),e[17]||(e[17]=o(" 发送 "))]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(J,{padless:"",color:"grey darken-3",class:"white--text text-center"},{default:a(()=>[t(P,{class:"py-2"},{default:a(()=>e[18]||(e[18]=[o("博弈策略助手 © 2025")])),_:1})]),_:1})]),_:1})}}},Ue=X(pe,[["__scopeId","data-v-3a676086"]]);export{Ue as default};
