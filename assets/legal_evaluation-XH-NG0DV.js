import{_ as N}from"./PageLayout-wVpgxbnR.js";import{s as c,c as j,A as K,K as f,L as t,D as P,J as m,h as a,M as o,H,Q as x,F as I,O,R,S as $,N as g,P as L,T as q,U as E}from"./index-BrTml2Fb.js";import{V as J,a as Q}from"./VFooter-DZSFhVtD.js";import{_ as X,j as _,r as u,t as G,v as S,w as W}from"./VContainer-27DPJaY0.js";import{b as Y,V as Z,a as ee,c as ae}from"./VAppBar-cBfAJn_8.js";import{V as te}from"./VRow-pG9w0uUi.js";import{V as U}from"./VCol-CwX0XoVG.js";import{V as B,a as le,c as M,d as se}from"./VCard-5mUneJXI.js";import{V as oe,a as re,b as ne}from"./VTextarea-DIXiXlS-.js";import{V as v}from"./VTextField-DDRmobaA.js";import{V as ie,a as h}from"./VList-DaZ_f4gr.js";import"./lazy-CYPMe5ey.js";const ue={class:"message-content"},de={class:"text-body-1"},me={class:"text-caption text-medium-emphasis mt-1 text-right"},pe={__name:"legal_evaluation",setup(ce){const p=c([{content:"您好！请发送消息，我会尽力为您提供帮助。",isUser:!1,timestamp:new Date().toLocaleTimeString()}]),r=c(""),d=c(!1),V=c(null),l=c({userType:"",deviceType:"",location:"",priceDifference:"",platform:"",evidence:""}),z=j(()=>Object.values(l.value).some(n=>n.trim()!=="")),A=()=>["【价格歧视分析请求】",l.value.userType&&`用户类型：${l.value.userType}`,l.value.deviceType&&`使用设备：${l.value.deviceType}`,l.value.location&&`所在地区：${l.value.location}`,l.value.priceDifference&&`价格差异：${l.value.priceDifference}元`,l.value.platform&&`发现平台：${l.value.platform}`,l.value.evidence&&`证据描述：${l.value.evidence}`].filter(Boolean).join(`
`),F=async()=>{const n=A();n&&(r.value=n,await w(),l.value={productName:"",productPrice:"",productLink:"",problemDescription:""})},T=async()=>{await P(),V.value&&V.value.$el.scrollTo({top:V.value.$el.scrollHeight,behavior:"smooth"})},w=async()=>{var y,s,b,C;if(!r.value.trim())return;const n={content:r.value,isUser:!0,timestamp:new Date().toLocaleTimeString()};p.value.push(n);const e=r.value;r.value="",await T(),d.value=!0;try{const k=()=>p.value.filter(i=>!i.hidden).map(i=>({role:i.isUser?"user":"assistant",content:i.content})).slice(-10),D=await Q.post("https://api.deepseek.com/v1/chat/completions",{messages:[{role:"system",content:`content: 你是一位专注反价格歧视的法律专家，请优先判断用户当前是否提出了需要法律/策略分析的问题
            你的回答不要使用以下模板，模板只是给你提供信息的，用自然的语言说出来：
            - 如用户仅提供背景信息，请先简要总结背景并澄清用户需求。
            - 如用户明确提出定价或合规问题，请再根据以下结构化流程处理请求：
            1. 【需求解析】分析用户输入是否为直接问题或背景陈述
            2. 【历史回溯】关联最近5轮对话内容：
            ${k().map(i=>`${i.role}: ${i.content}`).join(`
`)}
            3. 【法律分析】基于《电子商务法》第18条、《消法》第10条，依次评估：
              - 用户身份特征差异（新/老用户、设备类型）
              - 价格展示差异率计算：((当前价-基准价)/基准价)*100%
              - 平台算法歧视可能性（数据画像、动态定价特征）
              - 知情权与选择权保障缺失点
            4. 【结论输出】格式：
              法律结论：包含具体法条引用
              差异率：[数值]（保留两位小数）
              维权建议：分步骤操作指南
            `},{role:"user",content:e}],model:"deepseek-chat",temperature:.02,max_tokens:2e3},{headers:{Authorization:"Bearer sk-03b7d3c94bcc432ea14c45b2d501c58f","Content-Type":"application/json"}});(C=(b=(s=(y=D.data)==null?void 0:y.choices)==null?void 0:s[0])==null?void 0:b.message)!=null&&C.content&&p.value.push({content:D.data.choices[0].message.content,isUser:!1,timestamp:new Date().toLocaleTimeString()})}catch(k){p.value.push({content:`请求失败：${k.message}`,isUser:!1,timestamp:new Date().toLocaleTimeString()})}finally{d.value=!1,await T()}};return K(T),(n,e)=>{const y=N;return m(),f(y,null,{default:t(()=>[a(Y,{flat:"",color:"primary",dark:"",class:"app-bar",height:"80",elevation:4},{default:t(()=>[a(Z,{color:"transparent",class:"pt-2"},{default:t(()=>[a(_,{icon:"",onClick:e[0]||(e[0]=s=>n.$router.go(-1)),class:"mr-2"},{default:t(()=>[a(u,{size:"32",color:"white"},{default:t(()=>e[8]||(e[8]=[o("mdi-arrow-left-circle")])),_:1})]),_:1}),a(ee,{class:"text-h5 font-weight-bold white--text"},{default:t(()=>[e[10]||(e[10]=o(" 法律评判智能客服 ")),a(u,{right:"",dark:"",class:"ml-2"},{default:t(()=>e[9]||(e[9]=[o("mdi-currency-usd")])),_:1})]),_:1})]),_:1})]),_:1}),a(G,{class:"py-8"},{default:t(()=>[a(te,null,{default:t(()=>[a(U,{cols:"12",md:"4",class:"pr-md-4"},{default:t(()=>[a(B,{class:"template-card",elevation:"6"},{default:t(()=>[a(le,{class:"primary white--text"},{default:t(()=>[a(u,{left:""},{default:t(()=>e[11]||(e[11]=[o(" mdi-file-document-edit ")])),_:1}),e[12]||(e[12]=o(" 法律评判模板 "))]),_:1}),a(M,{class:"pt-4"},{default:t(()=>[a(oe,{ref:"form",class:"template-form"},{default:t(()=>[a(re,{modelValue:l.value.userType,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.userType=s),label:"用户类型",items:["新用户","老用户","会员用户"],variant:"outlined","prepend-inner-icon":"mdi-account-supervisor",required:""},null,8,["modelValue"]),a(v,{modelValue:l.value.deviceType,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.deviceType=s),label:"使用的设备类型",variant:"outlined","prepend-inner-icon":"mdi-cellphone",hint:"如iOS/Android设备型号","persistent-hint":""},null,8,["modelValue"]),a(v,{modelValue:l.value.location,"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.location=s),label:"所在地区",variant:"outlined","prepend-inner-icon":"mdi-map-marker"},null,8,["modelValue"]),a(v,{modelValue:l.value.priceDifference,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.priceDifference=s),label:"发现的价格差异",type:"number",variant:"outlined","prepend-inner-icon":"mdi-cash-multiple",suffix:"元",hint:"不同用户/渠道的价格差异金额","persistent-hint":""},null,8,["modelValue"]),a(v,{modelValue:l.value.platform,"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.platform=s),label:"发现平台",variant:"outlined","prepend-inner-icon":"mdi-web",hint:"如电商平台、旅行预订平台等","persistent-hint":""},null,8,["modelValue"]),a(ne,{modelValue:l.value.evidence,"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.evidence=s),label:"发现过程证据",variant:"outlined","prepend-inner-icon":"mdi-file-document",rows:"3","auto-grow":"",hint:"请描述如何发现价格差异（如比价过程、账户切换测试等）","persistent-hint":""},null,8,["modelValue"]),a(_,{block:"",color:"primary",class:"mt-4",disabled:!z.value,onClick:F},{default:t(()=>[a(u,{left:""},{default:t(()=>e[13]||(e[13]=[o(" mdi-gavel ")])),_:1}),e[14]||(e[14]=o(" 提交分析 "))]),_:1},8,["disabled"])]),_:1},512)]),_:1})]),_:1})]),_:1}),a(U,{cols:"12",md:"8",class:"pl-md-4"},{default:t(()=>[a(B,{class:"chat-container mx-auto",elevation:"6"},{default:t(()=>[a(M,{class:"message-window pa-4"},{default:t(()=>[a(ie,{class:"message-list",ref_key:"messageList",ref:V},{default:t(()=>[(m(!0),H(I,null,O(p.value,(s,b)=>(m(),f(ae,{key:b},{default:t(()=>[a(h,{class:$(["message-item",{"user-message":s.isUser}]),style:R({flexDirection:s.isUser?"row-reverse":"row"})},{default:t(()=>[s.isUser?x("",!0):(m(),f(S,{key:0,color:"primary",class:"mr-4",size:"40"},{default:t(()=>[a(u,{dark:""},{default:t(()=>e[15]||(e[15]=[o("mdi-robot-happy")])),_:1})]),_:1})),s.isUser?(m(),f(S,{key:1,color:"secondary",class:"ml-4",size:"40"},{default:t(()=>[a(u,{dark:""},{default:t(()=>e[16]||(e[16]=[o("mdi-account")])),_:1})]),_:1})):x("",!0),g("div",ue,[g("div",{class:$(["message-bubble",{"user-bubble":s.isUser}])},[g("div",de,L(s.content),1),g("div",me,L(s.timestamp),1)],2)])]),_:2},1032,["class","style"])]),_:2},1024))),128)),d.value?(m(),f(h,{key:0},{default:t(()=>[a(W,{indeterminate:"",color:"primary"})]),_:1})):x("",!0)]),_:1},512)]),_:1}),a(se,{class:"input-area pa-4"},{default:t(()=>[a(v,{modelValue:r.value,"onUpdate:modelValue":e[7]||(e[7]=s=>r.value=s),variant:"outlined",label:"输入您的消息","hide-details":"",onKeydown:q(E(w,["prevent"]),["enter"]),disabled:d.value},null,8,["modelValue","onKeydown","disabled"]),a(_,{color:"primary",class:"ml-4",onClick:w,disabled:!r.value||d.value,loading:d.value},{default:t(()=>[a(u,null,{default:t(()=>e[17]||(e[17]=[o("mdi-send")])),_:1}),e[18]||(e[18]=o(" 发送 "))]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(J,{padless:"",color:"grey darken-3",class:"white--text text-center"},{default:t(()=>[a(U,{class:"py-2"},{default:t(()=>e[19]||(e[19]=[o("法律评判助手 © 2025")])),_:1})]),_:1})]),_:1})}}},Ce=X(pe,[["__scopeId","data-v-4f5a28f6"]]);export{Ce as default};
