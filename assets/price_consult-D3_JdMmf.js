import{_ as j}from"./PageLayout-wVpgxbnR.js";import{s as p,c as A,A as N,K as f,L as a,D as K,J as m,h as t,M as o,H,Q as k,F as I,O,R,S as C,N as g,P as $,T as q,U as E}from"./index-BrTml2Fb.js";import{V as J,a as Q}from"./VFooter-DZSFhVtD.js";import{_ as X,j as S,r as u,t as G,v as L,w as W}from"./VContainer-27DPJaY0.js";import{b as Y,V as Z,a as ee,c as te}from"./VAppBar-cBfAJn_8.js";import{V as ae}from"./VRow-pG9w0uUi.js";import{V as T}from"./VCol-CwX0XoVG.js";import{V as P,a as se,c as D,d as le}from"./VCard-5mUneJXI.js";import{V as oe,a as re,b as ie}from"./VTextarea-DIXiXlS-.js";import{V as b}from"./VTextField-DDRmobaA.js";import{V as ne,a as M}from"./VList-DaZ_f4gr.js";import"./lazy-CYPMe5ey.js";const ue={class:"message-content"},de={class:"text-body-1"},me={class:"text-caption text-medium-emphasis mt-1 text-right"},ce={__name:"price_consult",setup(pe){const c=p([{content:"您好！请发送消息，我会尽力为您提供帮助。",isUser:!1,timestamp:new Date().toLocaleTimeString()}]),r=p(""),d=p(!1),v=p(null),l=p({industry:"",costStructure:"",competitorPrice:"",discountStrategy:"",pricingBasis:""}),h=A(()=>Object.values(l.value).some(i=>i.trim()!=="")),z=()=>["【定价策略分析请求】",l.value.industry&&`行业类型：${l.value.industry}`,l.value.costStructure&&`成本构成：${l.value.costStructure}`,l.value.competitorPrice&&`竞争价格：${l.value.competitorPrice}元`,l.value.discountStrategy&&`折扣策略：${l.value.discountStrategy}`,l.value.pricingBasis&&`定价依据：${l.value.pricingBasis}`].filter(Boolean).join(`
`),F=async()=>{const i=z();i&&(r.value=i,await x(),l.value={industry:"",costStructure:"",competitorPrice:"",discountStrategy:"",pricingBasis:""})},w=async()=>{await K(),v.value&&v.value.$el.scrollTo({top:v.value.$el.scrollHeight,behavior:"smooth"})},x=async()=>{var V,s,y,U;if(!r.value.trim())return;const i={content:r.value,isUser:!0,timestamp:new Date().toLocaleTimeString()};c.value.push(i);const e=r.value;r.value="",await w(),d.value=!0;try{const _=()=>c.value.filter(n=>!n.hidden).map(n=>({role:n.isUser?"user":"assistant",content:n.content})).slice(-10),B=await Q.post("https://api.deepseek.com/v1/chat/completions",{messages:[{role:"system",content:`你是一位专注定价合法性的分析师，请优先判断用户当前是否提出了需要法律/策略分析的问题
            你的回答不要使用以下模板，模板只是给你提供信息的，用自然的语言说出来：
            - 如用户仅提供背景信息，请先简要总结背景并澄清用户需求。
            - 如用户明确提出定价或合规问题，请再根据以下结构化流程处理请求：
            1. 【需求解析】分析用户输入是直接问题还是背景陈述，并提取关键诉求点  
            2. 【历史回溯】关联最近5轮对话内容：  
            ${_().map(n=>`[${n.role}]: ${n.content}`).join(`
`)}  
            3. 【法律分析】基于《价格法》《反垄断法》，逐项评估以下内容：  
              - 定价策略的合法合规性（如是否存在成本虚高、区域溢价等）  
              - 存在价格歧视风险（是否因用户类型、购买渠道等差异化定价）  
              - 与成本的合理比例关系（可计算毛利率/成本溢价率）  
              - 是否构成市场支配地位滥用（如限制交易、搭售、排他协议）  
            4. 【结论输出】格式如下：  
              合规性结论：结合具体条文说明  
              风险等级：[高/中/低]  
              改进建议：从定价模型、用户策略、合规机制角度提出优化方案`},{role:"user",content:e}],model:"deepseek-chat",temperature:.02,max_tokens:2e3},{headers:{Authorization:"Bearer sk-03b7d3c94bcc432ea14c45b2d501c58f","Content-Type":"application/json"}});(U=(y=(s=(V=B.data)==null?void 0:V.choices)==null?void 0:s[0])==null?void 0:y.message)!=null&&U.content&&c.value.push({content:B.data.choices[0].message.content,isUser:!1,timestamp:new Date().toLocaleTimeString()})}catch(_){c.value.push({content:`请求失败：${_.message}`,isUser:!1,timestamp:new Date().toLocaleTimeString()})}finally{d.value=!1,await w()}};return N(w),(i,e)=>{const V=j;return m(),f(V,null,{default:a(()=>[t(Y,{flat:"",color:"primary",dark:"",class:"app-bar",height:"80",elevation:4},{default:a(()=>[t(Z,{color:"transparent",class:"pt-2"},{default:a(()=>[t(S,{icon:"",onClick:e[0]||(e[0]=s=>i.$router.go(-1)),class:"mr-2"},{default:a(()=>[t(u,{size:"32",color:"white"},{default:a(()=>e[7]||(e[7]=[o("mdi-arrow-left-circle")])),_:1})]),_:1}),t(ee,{class:"text-h5 font-weight-bold white--text"},{default:a(()=>[e[9]||(e[9]=o(" 价格咨询智能客服 ")),t(u,{right:"",dark:"",class:"ml-2"},{default:a(()=>e[8]||(e[8]=[o("mdi-currency-usd")])),_:1})]),_:1})]),_:1})]),_:1}),t(G,{class:"py-8"},{default:a(()=>[t(ae,null,{default:a(()=>[t(T,{cols:"12",md:"4",class:"pr-md-4"},{default:a(()=>[t(P,{class:"template-card",elevation:"6"},{default:a(()=>[t(se,{class:"primary white--text"},{default:a(()=>[t(u,{left:""},{default:a(()=>e[10]||(e[10]=[o("mdi-file-document-edit")])),_:1}),e[11]||(e[11]=o(" 定价策略分析模板 "))]),_:1}),t(D,{class:"pt-4"},{default:a(()=>[t(oe,{ref:"form",class:"template-form"},{default:a(()=>[t(re,{modelValue:l.value.industry,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.industry=s),label:"行业类型",items:["电商零售","旅游服务","数字内容","生活服务"],variant:"outlined","prepend-inner-icon":"mdi-factory",required:""},null,8,["modelValue"]),t(b,{modelValue:l.value.costStructure,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.costStructure=s),label:"成本构成",variant:"outlined","prepend-inner-icon":"mdi-cash-register",hint:"原材料/人力/运营等成本占比","persistent-hint":""},null,8,["modelValue"]),t(b,{modelValue:l.value.competitorPrice,"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.competitorPrice=s),label:"竞争对手价格",type:"number",variant:"outlined","prepend-inner-icon":"mdi-sword-cross",suffix:"元"},null,8,["modelValue"]),t(b,{modelValue:l.value.discountStrategy,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.discountStrategy=s),label:"折扣策略",variant:"outlined","prepend-inner-icon":"mdi-sale",hint:"如首单优惠、会员折扣等","persistent-hint":""},null,8,["modelValue"]),t(ie,{modelValue:l.value.pricingBasis,"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.pricingBasis=s),label:"定价依据",variant:"outlined","prepend-inner-icon":"mdi-clipboard-text",rows:"3",hint:"根据成本/需求/竞争等因素的定价策略","persistent-hint":""},null,8,["modelValue"]),t(S,{block:"",color:"primary",class:"mt-4",onClick:F,disabled:!h.value},{default:a(()=>[t(u,{left:""},{default:a(()=>e[12]||(e[12]=[o("mdi-chart-box")])),_:1}),e[13]||(e[13]=o(" 提交分析 "))]),_:1},8,["disabled"])]),_:1},512)]),_:1})]),_:1})]),_:1}),t(T,{cols:"12",md:"8",class:"pl-md-4"},{default:a(()=>[t(P,{class:"chat-container mx-auto",elevation:"6"},{default:a(()=>[t(D,{class:"message-window pa-4"},{default:a(()=>[t(ne,{class:"message-list",ref_key:"messageList",ref:v},{default:a(()=>[(m(!0),H(I,null,O(c.value,(s,y)=>(m(),f(te,{key:y},{default:a(()=>[t(M,{class:C(["message-item",{"user-message":s.isUser}]),style:R({flexDirection:s.isUser?"row-reverse":"row"})},{default:a(()=>[s.isUser?k("",!0):(m(),f(L,{key:0,color:"primary",class:"mr-4",size:"40"},{default:a(()=>[t(u,{dark:""},{default:a(()=>e[14]||(e[14]=[o("mdi-robot-happy")])),_:1})]),_:1})),s.isUser?(m(),f(L,{key:1,color:"secondary",class:"ml-4",size:"40"},{default:a(()=>[t(u,{dark:""},{default:a(()=>e[15]||(e[15]=[o("mdi-account")])),_:1})]),_:1})):k("",!0),g("div",ue,[g("div",{class:C(["message-bubble",{"user-bubble":s.isUser}])},[g("div",de,$(s.content),1),g("div",me,$(s.timestamp),1)],2)])]),_:2},1032,["class","style"])]),_:2},1024))),128)),d.value?(m(),f(M,{key:0},{default:a(()=>[t(W,{indeterminate:"",color:"primary"})]),_:1})):k("",!0)]),_:1},512)]),_:1}),t(le,{class:"input-area pa-4"},{default:a(()=>[t(b,{modelValue:r.value,"onUpdate:modelValue":e[6]||(e[6]=s=>r.value=s),variant:"outlined",label:"输入您的消息","hide-details":"",disabled:d.value,onKeydown:q(E(x,["prevent"]),["enter"])},null,8,["modelValue","disabled","onKeydown"]),t(S,{color:"primary",class:"ml-4",disabled:!r.value||d.value,loading:d.value,onClick:x},{default:a(()=>[t(u,null,{default:a(()=>e[16]||(e[16]=[o("mdi-send")])),_:1}),e[17]||(e[17]=o(" 发送 "))]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(J,{padless:"",color:"grey darken-3",class:"white--text text-center"},{default:a(()=>[t(T,{class:"py-2"},{default:a(()=>e[18]||(e[18]=[o("价格咨询助手 © 2025")])),_:1})]),_:1})]),_:1})}}},Ue=X(ce,[["__scopeId","data-v-85cbc717"]]);export{Ue as default};
